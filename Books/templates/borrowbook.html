{% extends "base.html" %}
{% load static %}
{% block content %}

    <!-- Main Content -->
    <main class="py-8">
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Page Header -->
        <div class="text-center mb-8">
          <h1
            class="text-4xl md:text-5xl font-bold text-black mb-4 drop-shadow-lg"
          >
            <i class="fas fa-book-reader mr-3"></i>
            My Borrowed Books
          </h1>
          <p class="text-xl text-black max-w-2xl mx-auto">
            Track your borrowed books, return dates, and manage penalties
          </p>
        </div>

        <!-- Statistics Cards -->
        {% if borrowed %}
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
          <div class="glass-morphism rounded-2xl p-6 text-center hover-scale">
            <div
              class="bg-gradient-to-r from-blue-500 to-cyan-600 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3"
            >
                  <i class="fa-solid fa-book text-xl text-white"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800">
              {{ borrowed|length }}
            </h3>
            <p class="text-gray-600 text-sm">Total Books</p>
          </div>

          <!-- <div class="glass-morphism rounded-2xl p-6 text-center hover-scale">
            <div
              class="bg-gradient-to-r from-green-500 to-emerald-600 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <i class="fas fa-calendar-check text-white text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800" id="onTimeCount">0</h3>
            <p class="text-gray-600 text-sm">On Time</p>
          </div> -->

          <div class="glass-morphism rounded-2xl p-6 text-center hover-scale">
            <div
              class="bg-gradient-to-r from-orange-500 to-red-600 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <i class="fas fa-exclamation-triangle text-white text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800" id="overdueCount">
              0
            </h3>
            <p class="text-gray-600 text-sm">Overdue</p>
          </div>

          <div class="glass-morphism rounded-2xl p-6 text-center hover-scale">
            <div
              class="bg-gradient-to-r from-purple-500 to-indigo-600 w-12 h-12 rounded-full flex items-center justify-center mx-auto mb-3"
            >
              <i class="fas fa-dollar-sign text-white text-xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800" id="totalPenalty">
              $0
            </h3>
            <p class="text-gray-600 text-sm">Total Penalties</p>
          </div>
        </div>
        {% endif %}

        <!-- Books Content -->
        {% if borrowed %}
        <!-- Desktop Table View -->
        <div
          class="glass-morphism rounded-2xl overflow-hidden desktop-table animate-fade-in"
        >
          <table class="w-full overflow-scroll">
            <thead
              class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white"
            >
              <tr>
                <th class="px-6 py-4 text-left font-semibold">Number</th>
                <th class="px-6 py-4 text-left font-semibold">Book Title</th>
                <th class="px-6 py-4 text-left font-semibold">Borrow Date</th>
                <th class="px-6 py-4 text-left font-semibold">Return Date</th>
                <th class="px-6 py-4 text-left font-semibold">Price</th>
                <th class="px-6 py-4 text-left font-semibold">Penalty</th>
                <!-- <th class="px-6 py-4 text-left font-semibold">Status</th> -->
                <th class="px-6 py-4 text-center font-semibold">Actions</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-gray-200">
              {% for book in borrowed %}
              <tr
                class="hover:bg-white/50 transition-colors duration-200"
                data-book-return-date="{{ book.return_date }}"
                data-book-penalty="{{ book.panalty }}"
              >
                <td class="px-6 py-4 font-medium text-gray-800">
                  {{ forloop.counter }}
                </td>
                <td class="px-6 py-4">
                  <div class="flex items-center space-x-3">
                    <div
                      class="bg-gradient-to-r from-blue-500 to-cyan-600 w-10 h-10 rounded-full flex items-center justify-center"
                    >
                      <i class="fas fa-book text-white text-sm"></i>
                    </div>
                    <div>
                      <p class="font-semibold text-gray-800">
                        {{ book.book_title }}
                      </p>
                      <p class="text-sm text-gray-600">by {{ book.user }}</p>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 text-gray-700">
                  <div class="flex items-center space-x-2">
                    <i class="fas fa-calendar text-blue-500"></i>
                    <span>{{ book.borrow_date }}</span>
                  </div>
                </td>
                <td class="px-6 py-4 text-gray-700">
                  <div class="flex items-center space-x-2">
                    <i class="fas fa-calendar-alt text-orange-500"></i>
                    <span>{{ book.return_date }}</span>
                  </div>
                </td>
                <td class="px-6 py-4">
                  <span class="text-green-600 font-semibold"
                    >${{ book.borrow_price }}</span
                  >
                </td>
                <td class="px-6 py-4">
                  {% if book.penalty > 0 %}
                  <span class="text-red-600 font-semibold animate-pulse-gentle"
                    >${{ book.penalty }}</span
                  >
                  {% else %}
                  <span class="text-gray-400">$0</span>
                  {% endif %}
                </td>
                <!-- <td class="px-6 py-4">
                  <span
                    class="status-badge px-3 py-1 rounded-full text-white text-sm font-medium"
                  >
                    <i class="fas fa-circle text-xs mr-1"></i>
                    <span class="status-text">Checking...</span>
                  </span>
                </td> -->
                <td class="px-6 py-4">
                  <div class="flex items-center justify-center space-x-2">
                    <form
                      action="{% url 'return_book' id=book.id %}"
                      method="post"
                      class="inline"
                    >
                      {% csrf_token %}
                      <button
                        type="submit"
                        class="bg-gradient-to-r from-green-500 to-emerald-600 text-white px-4 py-2 rounded-lg font-medium hover:from-green-600 hover:to-emerald-700 transition-all duration-200 hover-scale text-sm"
                      >
                        <i class="fas fa-undo mr-1"></i>
                        Return
                      </button>
                    </form>
                    {% if book.panalty > 0 %}
                    <form action="#" method="post" class="inline">
                      {% csrf_token %}
                      <button
                        type="submit"
                        class="bg-gradient-to-r from-orange-500 to-red-600 text-white px-4 py-2 rounded-lg font-medium hover:from-orange-600 hover:to-red-700 transition-all duration-200 hover-scale text-sm"
                      >
                        <i class="fas fa-credit-card mr-1"></i>
                        Pay
                      </button>
                    </form>
                    {% endif %}
                  </div>
                </td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>

        <!-- Mobile Card View -->
        <div class="mobile-card space-y-4 mt-5">
          {% for book in borrowed %}
          <div
            class="book-item glass-morphism rounded-2xl p-6"
            data-book-return-date="{{ book.return_date }}"
            data-book-penalty="{{ book.panalty }}"
          >
            <!-- Book Header -->
            <div class="flex items-start justify-between mb-4">
              <div class="flex items-center space-x-3">
                <div
                  class="bg-gradient-to-r from-blue-500 to-cyan-600 w-12 h-12 rounded-full flex items-center justify-center"
                >
                  <i class="fas fa-book text-white"></i>
                </div>
                <div>
                  <h3 class="font-bold text-gray-800 text-lg">
                    {{ book.book_title }}
                  </h3>
                  <p class="text-gray-600 text-sm">by {{ book.user }}</p>
                </div>
              </div>
              <span
                class="status-badge-mobile inline-flex items-center px-3 py-1 rounded-full text-white text-xs font-medium whitespace-nowrap"
              >
                <i class="fas fa-circle text-xs mr-1"></i>
                <span class="status-text-mobile">Checking...</span>
              </span>
            </div>

            <!-- Book Details -->
            <div class="grid grid-cols-2 gap-4 mb-6 text-sm">
              <div class="space-y-2">
                <div class="flex items-center space-x-2">
                  <i class="fas fa-calendar text-blue-500 w-4"></i>
                  <span class="text-gray-600">Borrowed:</span>
                </div>
                <p class="font-medium text-gray-800 ml-6">
                  {{ book.borrow_date }}
                </p>
              </div>

              <div class="space-y-2">
                <div class="flex items-center space-x-2">
                  <i class="fas fa-calendar-alt text-orange-500 w-4"></i>
                  <span class="text-gray-600">Due Date:</span>
                </div>
                <p class="font-medium text-gray-800 ml-6">
                  {{ book.return_date }}
                </p>
              </div>

              <div class="space-y-2">
                <div class="flex items-center space-x-2">
                  <i class="fas fa-tag text-green-500 w-4"></i>
                  <span class="text-gray-600">Price:</span>
                </div>
                <p class="font-semibold text-green-600 ml-6">
                  ${{ book.borrow_price }}
                </p>
              </div>

              <div class="space-y-2">
                <div class="flex items-center space-x-2">
                  <i class="fas fa-exclamation-triangle text-red-500 w-4"></i>
                  <span class="text-gray-600">Penalty:</span>
                </div>
                {% if book.panalty > 0 %}
                <p class="font-semibold text-red-600 ml-6 animate-pulse-gentle">
                  ${{ book.panalty }}
                </p>
                {% else %}
                <p class="text-gray-400 ml-6">$0</p>
                {% endif %}
              </div>
            </div>

            <!-- Actions -->
            <div
              class="border-t border-gray-200 pt-4 flex flex-col sm:flex-row gap-3"
            >
              <form
                action="{% url 'return_book' id=book.id %}"
                method="post"
                class="flex-1"
              >
                {% csrf_token %}
                <button
                  type="submit"
                  class="w-full bg-gradient-to-r from-green-500 to-emerald-600 text-white py-3 rounded-lg font-semibold hover:from-green-600 hover:to-emerald-700 transition-all duration-200 hover-scale"
                >
                  <i class="fas fa-undo mr-2"></i>
                  Return Book
                </button>
              </form>
              {% if book.panalty > 0 %}
              <form action="#" method="post" class="flex-1">
                {% csrf_token %}
                <button
                  type="submit"
                  class="w-full bg-gradient-to-r from-orange-500 to-red-600 text-white py-3 rounded-lg font-semibold hover:from-orange-600 hover:to-red-700 transition-all duration-200 hover-scale"
                >
                  <i class="fas fa-credit-card mr-2"></i>
                  Pay Penalty
                </button>
              </form>
              {% endif %}
            </div>
          </div>
          {% endfor %}
        </div>
        {% else %}
        <!-- Empty State -->
        <div class="text-center py-16">
          <div class="glass-morphism rounded-2xl p-12 max-w-md mx-auto">
            <div
              class="bg-gradient-to-r from-blue-500 to-cyan-600 w-20 h-20 rounded-full flex items-center justify-center mx-auto mb-6"
            >
              <i class="fas fa-book-open text-white text-3xl"></i>
            </div>
            <h3 class="text-2xl font-bold text-gray-800 mb-4">
              No Borrowed Books
            </h3>
            <p class="text-gray-600 mb-6">
              You haven't borrowed any books yet. Start exploring our
              collection!
            </p>
            <a
              href="{% url 'books' %}"
              class="bg-gradient-to-r from-indigo-500 to-purple-600 text-white px-8 py-3 rounded-lg font-semibold hover:from-indigo-600 hover:to-purple-700 transition-all duration-200 hover-scale inline-flex items-center space-x-2"
            >
              <i class="fas fa-search"></i>
              <span>Browse Books</span>
            </a>
          </div>
        </div>
        {% endif %}
      </div>
    </main>

    <!-- Login Modal -->
    <div
      id="loginModal"
      class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-slide-up"
      >
        <div
          class="flex items-center justify-between p-6 border-b border-gray-200"
        >
          <h2
            class="text-2xl font-bold text-gray-800 flex items-center space-x-2"
          >
            <i class="fas fa-sign-in-alt text-indigo-600"></i>
            <span>Login</span>
          </h2>
          <button
            id="closeLoginModal"
            class="text-gray-400 hover:text-gray-600 text-xl"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form class="p-6" method="post" action="{% url 'login' %}">
          {% csrf_token %}
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-user mr-1"></i>
                Username
              </label>
              <input
                type="text"
                name="username"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                placeholder="Enter your username"
                required
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-lock mr-1"></i>
                Password
              </label>
              <input
                type="password"
                name="password"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                placeholder="Enter your password"
                required
              />
            </div>
          </div>

          <button
            type="submit"
            class="w-full mt-6 bg-gradient-to-r from-indigo-500 to-purple-600 text-white py-3 rounded-lg font-semibold hover:from-indigo-600 hover:to-purple-700 transition-all duration-200 hover-scale"
          >
            Sign In
          </button>
        </form>
      </div>
    </div>

    <!-- Register Modal -->
    <div
      id="registerModal"
      class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden flex items-center justify-center p-4"
    >
      <div
        class="bg-white rounded-2xl shadow-2xl w-full max-w-md animate-slide-up max-h-[90vh] overflow-y-auto"
      >
        <div
          class="flex items-center justify-between p-6 border-b border-gray-200 sticky top-0 bg-white rounded-t-2xl"
        >
          <h2
            class="text-2xl font-bold text-gray-800 flex items-center space-x-2"
          >
            <i class="fas fa-user-plus text-indigo-600"></i>
            <span>Register</span>
          </h2>
          <button
            id="closeRegisterModal"
            class="text-gray-400 hover:text-gray-600 text-xl"
          >
            <i class="fas fa-times"></i>
          </button>
        </div>

        <form class="p-6" action="{% url 'register' %}" method="post">
          {% csrf_token %}
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-user mr-1"></i>
                Username
              </label>
              <input
                type="text"
                name="username"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                placeholder="Choose a username"
                required
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-envelope mr-1"></i>
                Email
              </label>
              <input
                type="email"
                name="email"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                placeholder="your@email.com"
                required
              />
            </div>

            <div class="grid grid-cols-2 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  <i class="fas fa-id-card mr-1"></i>
                  First Name
                </label>
                <input
                  type="text"
                  name="fname"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                  placeholder="First name"
                  required
                />
              </div>

              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">
                  Last Name
                </label>
                <input
                  type="text"
                  name="lname"
                  class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                  placeholder="Last name"
                  required
                />
              </div>
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-lock mr-1"></i>
                Password
              </label>
              <input
                type="password"
                name="pass1"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                placeholder="Create a password"
                required
              />
            </div>

            <div>
              <label class="block text-sm font-medium text-gray-700 mb-2">
                <i class="fas fa-check-circle mr-1"></i>
                Confirm Password
              </label>
              <input
                type="password"
                name="pass2"
                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition-colors duration-200"
                placeholder="Confirm your password"
                required
              />
            </div>
          </div>

          <button
            type="submit"
            class="w-full mt-6 bg-gradient-to-r from-blue-500 to-cyan-600 text-white py-3 rounded-lg font-semibold hover:from-blue-600 hover:to-cyan-700 transition-all duration-200 hover-scale"
          >
            Create Account
          </button>
        </form>
      </div>
    </div>

    <script src="/static/js/borrow_book.js"></script>
  </body>
</html>
{% endblock %}